{"remainingRequest":"/Users/mac/Desktop/vue-template/vue3-typescript-template/node_modules/babel-loader/lib/index.js!/Users/mac/Desktop/vue-template/vue3-typescript-template/node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!/Users/mac/Desktop/vue-template/vue3-typescript-template/src/service/index.ts","dependencies":[{"path":"/Users/mac/Desktop/vue-template/vue3-typescript-template/src/service/index.ts","mtime":1629188147827},{"path":"/Users/mac/Desktop/vue-template/vue3-typescript-template/node_modules/cache-loader/dist/cjs.js","mtime":1618564461767},{"path":"/Users/mac/Desktop/vue-template/vue3-typescript-template/node_modules/babel-loader/lib/index.js","mtime":1618564461759},{"path":"/Users/mac/Desktop/vue-template/vue3-typescript-template/node_modules/ts-loader/index.js","mtime":1626082511152}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJ2YW50L2VzL3RvYXN0L3N0eWxlIjsKaW1wb3J0IF9Ub2FzdCBmcm9tICJ2YW50L2VzL3RvYXN0IjsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHsgQ09ERSwgQ09ERV9URVhUIH0gZnJvbSAnLi9jb2RlJzsKaW1wb3J0IHsgc3RvcmUgfSBmcm9tICdAL3N0b3JlL2luZGV4JzsKaW1wb3J0IHsgTXV0YXRpb25zRW51bSB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOwppbXBvcnQgcm91dGVyIGZyb20gJ0Avcm91dGVyL2luZGV4JzsKYXhpb3MuZGVmYXVsdHMuYmFzZVVSTCA9ICdodHRwczovL2FwaS5leGFtcGxlLmNvbSc7CmF4aW9zLmRlZmF1bHRzLmhlYWRlcnMucG9zdFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJzsKY29uc3QgQ2FuY2VsVG9rZW4gPSBheGlvcy5DYW5jZWxUb2tlbjsKY29uc3Qgc291cmNlID0gQ2FuY2VsVG9rZW4uc291cmNlKCk7CmF4aW9zLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgaWYgKCFjb25maWcuaGlkZWxvYWRpbmcpIHsKICAgIF9Ub2FzdC5sb2FkaW5nKHsKICAgICAgbWVzc2FnZTogJ+WKoOi9veS4rS4uLicsCiAgICAgIGZvcmJpZENsaWNrOiB0cnVlLAogICAgICBsb2FkaW5nVHlwZTogJ3NwaW5uZXInCiAgICB9KTsKICB9CgogIGlmIChzdG9yZS5zdGF0ZS50b2tlbikgewogICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9IGB0b2tlbiAke3N0b3JlLnN0YXRlLnRva2VufWA7CiAgfSBlbHNlIHsKICAgIGNvbmZpZy5jYW5jZWxUb2tlbiA9IHNvdXJjZS50b2tlbjsgLy8g5YWo5bGA5re75YqgY2FuY2VsVG9rZW4KICB9CgogIHJldHVybiBjb25maWc7Cn0sIGZ1bmN0aW9uIChlcnJvcikgewogIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7Cn0pOwpheGlvcy5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKGZ1bmN0aW9uIChyZXNwb25zZSkgewogIF9Ub2FzdC5jbGVhcigpOwoKICBjb25zdCB7CiAgICBzdGF0dXMKICB9ID0gcmVzcG9uc2U7CiAgY29uc3QgaW5kZXggPSBDT0RFLmZpbmRJbmRleChyZXMgPT4gcmVzID09PSBzdGF0dXMpOwoKICBpZiAoQ09ERS5pbmNsdWRlcyhzdGF0dXMpKSB7CiAgICBfVG9hc3QuZmFpbChDT0RFX1RFWFRbaW5kZXhdKTsKCiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoQ09ERV9URVhUW2luZGV4XSk7CiAgfQoKICBpZiAoc3RhdHVzID09PSA0MDApIHsKICAgIHN0b3JlLmNvbW1pdChNdXRhdGlvbnNFbnVtLlJlbW92ZVRva2VuKTsKICAgIGNvbnN0IHBhdGggPSByb3V0ZXIuY3VycmVudFJvdXRlOwogICAgcGF0aC5wYXRoICE9PSAnbG9naW4nICYmIHJvdXRlci5yZXBsYWNlKHsKICAgICAgcGF0aDogJ2xvZ2luJywKICAgICAgcXVlcnk6IHsKICAgICAgICByZWRpcmVjdDogcGF0aC5wYXRoCiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmV0dXJuIHJlc3BvbnNlOwp9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTs="},{"version":3,"sources":["/Users/mac/Desktop/vue-template/vue3-typescript-template/src/service/index.ts"],"names":[],"mappings":";;AAEA,OAAO,KAAP,MAAkB,OAAlB;AAEA,SAAS,IAAT,EAAe,SAAf,QAAgC,QAAhC;AACA,SAAS,KAAT,QAAsB,eAAtB;AACA,SAAS,aAAT,QAA8B,wBAA9B;AACA,OAAO,MAAP,MAAmB,gBAAnB;AAGA,KAAK,CAAC,QAAN,CAAe,OAAf,GAAyB,yBAAzB;AACA,KAAK,CAAC,QAAN,CAAe,OAAf,CAAuB,IAAvB,CAA4B,cAA5B,IAA8C,mCAA9C;AACA,MAAM,WAAW,GAAG,KAAK,CAAC,WAA1B;AACA,MAAM,MAAM,GAAG,WAAW,CAAC,MAAZ,EAAf;AAIA,KAAK,CAAC,YAAN,CAAmB,OAAnB,CAA2B,GAA3B,CAA+B,UAAU,MAAV,EAAqB;AAClD,MAAI,CAAC,MAAM,CAAC,WAAZ,EAAyB;AACvB,WAAM,OAAN,CAAc;AACZ,MAAA,OAAO,EAAE,QADG;AAEZ,MAAA,WAAW,EAAE,IAFD;AAGZ,MAAA,WAAW,EAAE;AAHD,KAAd;AAMD;;AAED,MAAI,KAAK,CAAC,KAAN,CAAY,KAAhB,EAAuB;AACrB,IAAA,MAAM,CAAC,OAAP,CAAe,aAAf,GAA+B,SAAS,KAAK,CAAC,KAAN,CAAY,KAAK,EAAzD;AACD,GAFD,MAEO;AACL,IAAA,MAAM,CAAC,WAAP,GAAqB,MAAM,CAAC,KAA5B,CADK,CAC6B;AACnC;;AAED,SAAO,MAAP;AACD,CAjBD,EAiBG,UAAU,KAAV,EAAmE;AAEpE,SAAO,OAAO,CAAC,MAAR,CAAe,KAAf,CAAP;AACD,CApBD;AAuBA,KAAK,CAAC,YAAN,CAAmB,QAAnB,CAA4B,GAA5B,CAAgC,UAAU,QAAV,EAAkB;AAChD,SAAM,KAAN;;AACA,QAAM;AAAE,IAAA;AAAF,MAAa,QAAnB;AACA,QAAM,KAAK,GAAG,IAAI,CAAC,SAAL,CAAgB,GAAD,IAAiB,GAAG,KAAK,MAAxC,CAAd;;AACA,MAAI,IAAI,CAAC,QAAL,CAAc,MAAd,CAAJ,EAA2B;AACzB,WAAM,IAAN,CAAW,SAAS,CAAC,KAAD,CAApB;;AACA,WAAO,OAAO,CAAC,MAAR,CAAe,SAAS,CAAC,KAAD,CAAxB,CAAP;AACD;;AACD,MAAI,MAAM,KAAK,GAAf,EAAoB;AAClB,IAAA,KAAK,CAAC,MAAN,CAAa,aAAa,CAAC,WAA3B;AACA,UAAM,IAAI,GAAG,MAAM,CAAC,YAApB;AACA,IAAA,IAAI,CAAC,IAAL,KAAc,OAAd,IACE,MAAM,CAAC,OAAP,CAAe;AACb,MAAA,IAAI,EAAE,OADO;AAEb,MAAA,KAAK,EAAE;AAAE,QAAA,QAAQ,EAAE,IAAI,CAAC;AAAjB;AAFM,KAAf,CADF;AAKD;;AACD,SAAO,QAAP;AACD,CAlBD,EAkBG,UAAU,KAAV,EAAmE;AAEpE,SAAO,OAAO,CAAC,MAAR,CAAe,KAAf,CAAP;AACD,CArBD","sourcesContent":["\n\nimport axios from 'axios'\nimport { Toast } from 'vant'\nimport { CODE, CODE_TEXT } from './code'\nimport { store } from '@/store/index'\nimport { MutationsEnum } from '@/store/mutation-types'\nimport router from '@/router/index'\n\n\naxios.defaults.baseURL = 'https://api.example.com'\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded'\nconst CancelToken = axios.CancelToken\nconst source = CancelToken.source()\n\n\n\naxios.interceptors.request.use(function (config: any) {\n  if (!config.hideloading) {\n    Toast.loading({\n      message: '加载中...',\n      forbidClick: true,\n      loadingType: 'spinner',\n    })\n\n  }\n\n  if (store.state.token) {\n    config.headers.Authorization = `token ${store.state.token}`\n  } else {\n    config.cancelToken = source.token // 全局添加cancelToken\n  }\n\n  return config\n}, function (error: AxiosLib.ExtendsAxiosError<FetchResponse.Response>) {\n\n  return Promise.reject(error)\n})\n\n\naxios.interceptors.response.use(function (response) {\n  Toast.clear()\n  const { status } = response\n  const index = CODE.findIndex((res: number) => res === status)\n  if (CODE.includes(status)) {\n    Toast.fail(CODE_TEXT[index])\n    return Promise.reject(CODE_TEXT[index])\n  }\n  if (status === 400) {\n    store.commit(MutationsEnum.RemoveToken)\n    const path = router.currentRoute as any\n    path.path !== 'login' &&\n      router.replace({\n        path: 'login',\n        query: { redirect: path.path },\n      })\n  }\n  return response\n}, function (error: AxiosLib.ExtendsAxiosError<FetchResponse.Response>) {\n\n  return Promise.reject(error)\n})\n\n\n"],"sourceRoot":""}]}